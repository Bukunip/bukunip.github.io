<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">
<title>Puzzle 4x4</title>

<style>
body{
  margin:0;
  background:#111;
  font-family:sans-serif;
  color:white;
  text-align:center;
}

#menu{
  padding:20px;
}

.thumb{
  width:80px;
  margin:10px;
  border-radius:8px;
  cursor:pointer;
  border:2px solid white;
}

#game{
  display:none;
}

#preview{
  width:100px;
  margin:10px;
  border-radius:8px;
  border:2px solid white;
}

#board{
  width:92vw;
  max-width:420px;
  aspect-ratio:1/1;
  position:relative;
  margin:auto;
}

.tile{
  position:absolute;
  width:25%;
  height:25%;
  background-size:400% 400%;
  transition:0.15s ease;
  border-radius:6px;
}

#controls{
  margin-top:15px;
  display:none;
}

button{
  padding:8px 15px;
  margin:6px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
</style>
</head>
<body>

<!-- MENU PILIH GAMBAR -->
<div id="menu">
  <h2>Pilih Gambar</h2>
</div>

<!-- GAME AREA -->
<div id="game">
  <button onclick="goBack()">â¬… Back</button>
  <br>
  <img id="preview">
  <div id="board"></div>

  <div id="controls">
    <h3>Level Selesai ðŸŽ‰</h3>
    <button onclick="downloadImage()">Download</button>
  </div>
</div>

<script>
const images = [
"pelacur-berjilbab-hunaifatul-azizah-aini-11.jpg",
"pelacur-berjilbab-hunaifatul-azizah-aini-12.jpg",
"pelacur-berjilbab-hunaifatul-azizah-aini-16.jpg",
"pelacur-berjilbab-hunaifatul-azizah-aini-03.jpg",
"pelacur-berjilbab-hunaifatul-azizah-aini-13.jpg"
];

const size=4;
let tiles=[];
let empty;
let currentImage=0;

const menu=document.getElementById("menu");
const game=document.getElementById("game");
const board=document.getElementById("board");
const preview=document.getElementById("preview");
const controls=document.getElementById("controls");

/* BUAT THUMBNAIL MENU */
images.forEach((img,index)=>{
  let thumb=document.createElement("img");
  thumb.src=img;
  thumb.className="thumb";
  thumb.onclick=()=>startGame(index);
  menu.appendChild(thumb);
});

function startGame(index){
  currentImage=index;
  menu.style.display="none";
  game.style.display="block";
  init();
}

function goBack(){
  game.style.display="none";
  menu.style.display="block";
  board.innerHTML="";
  controls.style.display="none";
}

function init(){
  board.innerHTML="";
  tiles=[];
  empty={row:3,col:3};
  controls.style.display="none";
  preview.src=images[currentImage];

  for(let r=0;r<size;r++){
    for(let c=0;c<size;c++){
      if(r===3 && c===3) continue;

      let tile=document.createElement("div");
      tile.className="tile";
      tile.style.backgroundImage=`url(${images[currentImage]})`;
      tile.style.backgroundPosition=`${c*33.33}% ${r*33.33}%`;
      tile.style.left=(c*25)+"%";
      tile.style.top=(r*25)+"%";
      tile.dataset.row=r;
      tile.dataset.col=c;
      tile.onclick=move;
      board.appendChild(tile);
      tiles.push(tile);
    }
  }

  shuffle();
}

function move(){
  let r=parseInt(this.dataset.row);
  let c=parseInt(this.dataset.col);

  if((Math.abs(r-empty.row)+Math.abs(c-empty.col))===1){
    this.style.left=(empty.col*25)+"%";
    this.style.top=(empty.row*25)+"%";
    this.dataset.row=empty.row;
    this.dataset.col=empty.col;
    empty={row:r,col:c};
    checkWin();
  }
}

function shuffle(){
  for(let i=0;i<300;i++){
    let neighbors=tiles.filter(t=>{
      let r=parseInt(t.dataset.row);
      let c=parseInt(t.dataset.col);
      return (Math.abs(r-empty.row)+Math.abs(c-empty.col))===1;
    });
    let rand=neighbors[Math.floor(Math.random()*neighbors.length)];
    rand.click();
  }
}

function checkWin(){
  let win=true;
  tiles.forEach(t=>{
    let r=parseInt(t.dataset.row);
    let c=parseInt(t.dataset.col);
    let correctRow=Math.floor(parseFloat(t.style.backgroundPosition.split(" ")[1])/33.33);
    let correctCol=Math.floor(parseFloat(t.style.backgroundPosition.split(" ")[0])/33.33);
    if(r!==correctRow || c!==correctCol){
      win=false;
    }
  });

  if(win){
    controls.style.display="block";
  }
}

function downloadImage(){
  let link=document.createElement("a");
  link.href=images[currentImage];
  link.download="gambar.jpg";
  link.click();
}
</script>

</body>
</html>
